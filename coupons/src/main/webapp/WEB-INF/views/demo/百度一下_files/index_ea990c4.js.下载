rain.rainshell("dislike#v1.0.17",function(t,e,i,a){t("rainModule/BdrainswDislike/index",function(t){function e(){this.dislikeCache={},this.moveFlag=!0,this.touchLength=0,this.startPageX=0,this.startPageY=0,this.closeBtn=!0}var i,n,o,s,d,r,l,c=t("wiseindex/lib/thunder/thunder"),h=/logExtra:yc:(.*);yc;/,u=window.sSession,f=$("#index-kw"),p="确定",m="不感兴趣";return e.prototype={init:function(){this.initThunder(),this.eventHandlers(),this.orientationInit()},initThunder:function(){var t={logid:u.logid||"",ssid:u.ssid||"",from:u.from||"",pu:u.pu||"",sid:u.sids||""};l=c.create({baseParams:t})},handleListener:function(t,e){this.dataToDom(t,e)},dataToDom:function(t,e){for(var i=this,a=t.data,l=[],c=0;c<a.length;c++)l.push(c%2===0?'<a href="javascript:;" class="border-handle">'+a[c]+"</a>":'<a href="javascript:;" class="content-line-right border-handle">'+a[c]+"</a>");s=e.find(".content-line"),s.html(l.join("")),d=e.find(".dislikeMask"),r=s.find("a"),n=e.find(".wise-dislike"),o=e.find(".reason-upload"),setTimeout(function(){i.goPosition(t.position),d.show(),n.show()},0)},goPosition:function(t){var e=window.innerHeight;t.y&&2*t.y>e?(n.addClass("triangleBottom frameShowBottom").removeClass("triangleTop frameShowTop"),n.css({bottom:e-t.y,top:"auto"})):(n.addClass("triangleTop frameShowTop").removeClass("triangleBottom frameShowBottom"),n.css({top:t.y+35,bottom:"auto"}))},eventHandlers:function(){var t=this;$(".content-line").off("touchend").on("touchend","a",function(t){t.preventDefault();var e=$(this);e.hasClass("a-checked")?e.removeClass("a-checked"):e.addClass("a-checked"),o.text(r.hasClass("a-checked")?p:m)}),$(".reason-upload").off("click").on("click",function(){var e=[];if(a.removeClass("dislike-selected"),r.each(function(){$(this).hasClass("a-checked")&&e.push($(this).text())}),e.length>0?e:e.push(m),+t.dislikeCache.isAfd){var i=t.dislikeCache.logHandle,n=window.ecom&&(window.ecom[i]||window.ecom.dislikeStats);n&&n(t.dislikeCache.ele,e)}else{var o=JSON.parse(t.dislikeCache.extra),s=[],d=[],c=[],h=[],u=/看过类似的/,f=/屏蔽来源(:|：)/,p=/不想看(:|：)/;e.forEach(function(t){u.test(t)?c.push(t):f.test(t)?d.push(t.replace(f,"")):p.test(t)?s.push(t.replace(p,"")):h.push(t)}),l.send({tid:"1381",ct:1,cst:2,logFrom:"mid_news",logInfo:"l4",logExtra:JSON.stringify({st:t.dislikeCache.st,rid:t.dislikeCache.rid,extra:o,pos:t.dislikeCache.pos,content:h,flow:1,source:d,tag:s,repeat:c})})}t.hideDislikeAndMask(),t.removeComponent(t.dislikeCache.rid),t.tips("将为你减少推荐类似内容")}),$(".dislikeMask").off("touchend").on("touchend",function(e){t.moveFlag===!0&&(e.preventDefault(),t.hideDislikeAndMask(),t.dislikeCache={},a.removeClass("dislike-selected"))}),$(".dislikeMask, .wise-dislike").off("touchmove").on("touchmove",function(e){t.moveFlag=!1,e.preventDefault(),e.stopPropagation(),$(this).on("touchend",function(){t.moveFlag=!0})}),a.off("touchstart").on("touchstart","[data-dislikeData]",function(e){f&&f.blur(),t.closeBtn=!0,e.preventDefault(),t.startPageY=e.touches[0].pageY,t.touchLength=e.touches.length}),a.off("touchmove").on("touchmove","[data-dislikeData]",function(e){var i=e.touches[0].pageY,a=Math.abs(i-t.startPageY);a>10&&(t.closeBtn=!1)}),a.off("touchend").on("touchend","[data-dislikeData]",function(e){if(t.touchLength>1||!t.closeBtn)return!1;a.addClass("dislike-selected"),e.preventDefault(),e.stopPropagation();var n,o,s=$(this),d=[],r=s.siblings(".hide-dislike-data"),c=r.attr("nid")||r.attr("data-rid"),u=r.attr("pos")||r.attr("data-pos"),f=r.data("domain")||"",p=s[0].getBoundingClientRect().top,m=1===parseInt(r.attr("dislike-type"),10)?1:0;if(r.find("i").each(function(){d.push($(this).text())}),n={position:{y:p},data:d},m){var v=JSON.parse(r.attr("data-log")),g=r.attr("data-handler"),k=v.st,C=v.extra;o={st:k,extra:C}}else{var w=r.attr("dislog");o=JSON.parse(w.match(h)[1])}t.dislikeCache={rid:c,pos:u,source:f,isAfd:m,st:o.st,extra:o.extra,logHandle:g,ele:r},i=$("body"),t.handleListener(n,i),l.send({tid:"1380",ct:1,cst:2,logFrom:"mid_news",logInfo:"dislike",logExtra:JSON.stringify({st:o.st,rid:c.toString(),extra:o.extra,pos:u.toString()})})})},hideDislikeAndMask:function(){n.hide(),r.each(function(){$(this).removeClass("a-checked")}),d.hide(),o.text(m),s.html("")},removeComponent:function(t){i.find(".hide-dislike-data").each(function(){var e=$(this).attr("nid")||$(this).attr("data-rid");return e===t?($(this).parents("[data-click-grey]").remove(),!1):void 0})},tips:function(t){var e=$('<div class="l-tips">'+t+"</div>");$("body").append(e),setTimeout(function(){e.remove()},3e3)},debounce:function(t,e){var i=null;return function(){var a=this,n=arguments;clearTimeout(i),i=setTimeout(function(){t.apply(a,n)},e)}},orientationInit:function(){var t=this;window.addEventListener("orientationchange",t.orientationClient)},orientationClient:function(){return d&&n?(n.hide(),void d.hide()):!1}},new e}),e(["rainModule/BdrainswDislike/index"],function(t){t.init()})});
define(function(){function t(){return $(window).scrollTop()+$(window).height()}function e(){return window.sSession&&window.sSession.isLogin&&"1"===window.sSession.isLogin}function a(t){7>=t?t=7:t>7&&14>=t&&(t=14);var e=window.localStorage&&window.localStorage.getItem("total_request"+t);if(e){var a=e.split("_")[1];return a}return 0}function o(t){7>=t?t=7:t>7&&14>=t&&(t=14);var e=window.localStorage&&window.localStorage.getItem("total_request"+t),a=new Date,o=parseInt(a.getFullYear()+""+(a.getMonth()+1)+a.getDate(),10);if(e){var n=parseInt(e.split("_")[0],10),i=parseInt(e.split("_")[1],10);o>n?window.localStorage.setItem("total_request"+t,o+"_1"):(i++,window.localStorage.setItem("total_request"+t,o+"_"+i))}else window.localStorage&&window.localStorage.setItem("total_request"+t,o+"_1")}function n(t){var o=location.href.match(/from=([^&/]*)/),n={query:"wise_index",cp:"wise_home_page",pui:e()?1:0,pn:++k,from:o?o[1]:"0",wsw:screen.availWidth,wsh:screen.availHeight,wiw:$(window).width(),wih:$(window).height(),sid:window.sSession&&window.sSession.logid||"",wosid:window.sSession&&window.sSession.osid||"",wbwsid:window.sSession&&window.sSession.browserid||"",isWiFi:window.sSession&&window.sSession.isWifi||"",nettype:f(),fc:t.attr("data-fresh-count"),ft:t.attr("data-fresh-type"),pos:E,total:a(E)||1,ecom:_("ecom")};return L={freshCount:n.fc,freshType:n.ft},n}function i(){return q[k+1]||T}function d(t){try{("undefined"==typeof window.AFD_ADSENSE||$.isArray(window.AFD_ADSENSE)===!1)&&(window.AFD_ADSENSE=[]),window.AFD_ADSENSE.push(t),window.AFD_ADSENSE[window.AFD_ADSENSE.length-1].freshData=L}catch(e){}}function r(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in e)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?e[a]:("00"+e[a]).substr((""+e[a]).length)));return t}function s(t){if(t){var e=(new Date).getTime(),a=new Image;t+="&rand="+(e+Math.random()),a.onload=a.onerror=a.onabort=function(){a.onload=a.onerror=a.onabort=null,a=null},a.src=t}}function w(t){var e={baiduid:window.B&&window.B.cookie&&window.B.cookie("BAIDUID"),tag:"wise_home",action:"renderfail",pn:k,sid:window.B.cookie("H_WISE_SIDS"),pre_qid:window.sSession&&window.sSession.logid||"",extends_1:JSON&&JSON.stringify(N)};e=$.extend(e,t||{}),s(I+"?"+l(e))}function c(t){var e="//als.baidu.com/clog/glog",a={productId:8,_client_type:"1",_os_type:window.sSession&&window.sSession.osid||"0",baiduid:window.B&&window.B.cookie&&window.B.cookie("BAIDUID"),da_page:"index",logid:window.sSession&&window.sSession.logid||""};a=$.extend(a,t||{}),s(e+"?"+l(a))}function l(t){var e=[];for(var a in t)t.hasOwnProperty(a)&&e.push(encodeURIComponent(a)+"="+encodeURIComponent(t[a]));return e.join("&")}function _(t){var e=window.location.href;t=t.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),o=a.exec(e);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}function f(){var t=2,e=navigator.connection;return e&&e.type&&("wifi"===e.type||2===e.type)&&(t=1),t}function p(){var e=t(),a=$(".ads-item");a.filter(":not([data-fresh-type])").attr({"data-fresh-type":P,"data-fresh-count":R}),a.each(function(t,a){var o=$(a),n=o.offset().top;if("true"!==o.attr("data-init")){var d=n-e,r=i();M&&d>=10&&r>=d&&(o.attr("data-init","true"),N.startPos=e,N.adPos=n,N.startTime&&(N.lastTime=N.startTime),E=o.index()+1,g(o))}}),clearTimeout(y),y=setTimeout(u,150)}function u(){var e=t(),a=$(".ads-item");a.each(function(t,a){var o=$(a),n=o.offset().top,i=o.find("a");if(o.height()>0&&i.length>0&&e>n){var d=i.attr("data-pos"),s=i.attr("data-pn"),l=o.attr("data-apr")||0;l&&(l=+l);var _={},f=(e-n)/o.height();f=f>1?1:f,_.apr=+f.toFixed(2),_.apr>l&&o.attr("data-apr",_.apr);var p=i.attr("data-show"),u=i.attr("data-rank"),g=i.attr("data-adid"),m=i.attr("data-searchId"),h=i.attr("data-src"),x=i.attr("data-cmatch")||"",S=i.attr("data-ip")||"",v=i.attr("data-time")||"";"true"!==p&&e-n>.3*o.height()&&(i.attr("data-show","true"),w({action:"adsexposure",baiduid:window.B&&window.B.cookie&&window.B.cookie("BAIDUID"),searchId:m,rank:u||1,adid:g,src:h||1026,time:r.call(new Date,"yyyy-MM-dd HH:mm:ss"),ck:"",pn:s,extends_1:_.apr,extends_2:d,cmatch:x,ip:S,request_time:v}),window.B.thunderLog&&window.B.thunderLog.send&&window.B.thunderLog.send({ct:1,cst:10,logFrom:"mid_news",rids:i.attr("data-rid"),pos:i.attr("data-pos"),searchId:m}));var y=i.attr("data-showfor1px");"true"!==y&&e>n&&(i.attr("data-showfor1px","true"),c({da_page_num:s,da_locate:d,da_type:3,origin_time:(new Date).getTime(),ext_info:i.attr("data-ext_info")||""}))}var D=o.attr("data-store");"true"!==D&&0===o.height()&&o.attr("data-ext_info")&&e>n&&(o.attr("data-store","true"),c({da_type:3,da_locate:o.index()+1,origin_time:(new Date).getTime(),ext_info:o.attr("data-ext_info")||""}))})}function g(e){m(),e.removeAttr("data-rid"),e.removeAttr("data-pos");var a=B;D&&(a=B+"&show_info="+D);var i=window.sSession&&window.sSession.sids||$("#commonBase").data("sids")||"",r={da_type:6,da_freshType:e.attr("data-fresh-type"),da_freshCount:e.attr("data-fresh-count"),origin_time:(new Date).getTime(),da_ext2:JSON&&JSON.stringify(N),da_ext4:i};o(E);var s=n(e);$.ajax({url:a,type:"GET",dataType:"jsonp",timeout:5e3,data:s}).done(function(a){d($.extend(a,{requestParams:s,cookie:window.B&&window.B.cookie&&window.B.cookie("BAIDUID")})),h(e),S();var o=t(),n=e.offset().top;if(0!==a.err_no)return void c($.extend(r,{da_ext1:1}));if(a.ad_place_list.length&&!a.ad_place_list[0].ad_place_data&&a.ad_place_list[0].ad_item_list.length&&a.ad_place_list[0].ad_item_list[0].ext_info&&e.attr("data-ext_info",a.ad_place_list[0].ad_item_list[0].ext_info),a.ad_place_list.length<=0||!a.ad_place_list[0].ad_place_data)return void c($.extend(r,{da_ext1:2}));if(n>o+b){var i=e.html(a.ad_place_list[0].ad_place_data).find("a").filter(':not([data-type="ec_ad_download_btn"])').filter(":not([data-exclude-afd])"),w=i.attr("data-searchId")||Math.floor(1e17*Math.random());if(i.attr({"data-rid":"ecomads-"+w+"-"+k,"data-pos":E,"data-pn":k}),a.ad_place_list[0].ad_place_js.length>0)try{i.attr("data-ext_info",a.ad_place_list[0].ad_place_js)}catch(l){}var _=i.attr("data-showinfo");return _&&(D=_),i.bind("click",function(){c({da_area:"hotarea",da_page_num:i.attr("data-pn"),da_locate:i.attr("data-pos"),da_type:2,origin_time:(new Date).getTime(),ext_info:i.attr("data-ext_info")||""})}),e.find('[data-type="ec_ad_asyn_phone"]').on("click",function(t){t.stopPropagation(),c({da_area:"button",da_page_num:i.attr("data-pn"),da_locate:i.attr("data-pos"),da_type:2,origin_time:(new Date).getTime(),ext_info:i.attr("data-ext_info")||""}),window.B.thunderLog&&window.B.thunderLog.send&&window.B.thunderLog.send({ct:1,cst:2,logFrom:"mid_news",logInfo:"btn_tel",rids:i.attr("data-rid"),pos:i.attr("data-pos")})}),void e.find('[data-type="ec_ad_download_label"]').on("click",function(t){t.stopPropagation(),c({da_area:"downbtn",da_page_num:i.attr("data-pn"),da_locate:i.attr("data-pos"),da_type:2,origin_time:(new Date).getTime(),ext_info:i.attr("data-ext_info")||""}),window.B.thunderLog&&window.B.thunderLog.send&&window.B.thunderLog.send({ct:1,cst:2,logFrom:"mid_news",logInfo:"btn_dl",rids:i.attr("data-rid"),pos:i.attr("data-pos")})})}c($.extend(r,{da_ext1:4}))}).fail(function(t,a){d({textStatus:a}),h(e),S(),c($.extend(r,{da_ext1:5,da_ext3:a}))})}function m(){N.startTime=(new Date).getTime(),N.interval=N.startTime-N.lastTime}function h(e){N.endTime=(new Date).getTime(),N.requestTime=N.endTime-N.startTime;var a=t(),o=e.offset().top;N.endPos=a,N.distance=o-a}function x(){var t=$("[name=word]");t.on("focus",function(){M=!1}),t.on("blur",function(){M=!0}),$(window).on("scroll",p)}function S(){var t=window.B.cookie("pub_env");"9"===t&&setTimeout(function(){if(!document.getElementById("_tb_w")){var t=document.createElement("script");t.setAttribute("charset","utf-8"),t.id="_tb_w",t.src="//tb1.bdstatic.com/tb/_tb_bkmklet.js?"+Math.floor(+new Date),document.body.appendChild(t)}},20)}function v(){x(),window.ecom=window.ecom||{},window.ecom.fclick=w,window.ecom.request=s,window.ecom.paramsToUrl=l}var y,D,T=500,b=5,B="//feed.baidu.com/feed/api/wise/getwiseafdads?_api=new",I="http:"===location.protocol?"http://fclick.baidu.com/w.gif":"https://sp0.baidu.com/-rU_dTmfKgQFm2e88IuM_a/w.gif",k=-1,E=7,A=0,F=1,M=!0,q={},L="",N={height:$(window).height(),interval:0,lastTime:(new Date).getTime(),startTime:0,endTime:0,startPos:0,endPos:0,adPos:0,requestTime:0,distance:0},P=3,R=F;return window.B&&window.B.listen("skeleton/tab","afrInsertDom1",function(){P=3,R=++F}),window.B&&window.B.listen("skeleton/tab","preInsertDom1",function(){P=4,R=++A}),{init:v}});
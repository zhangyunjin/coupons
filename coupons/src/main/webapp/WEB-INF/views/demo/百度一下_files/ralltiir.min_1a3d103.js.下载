!function(){define(["sfr"],function(t){return t}),define("ralltiir",["sfr"],function(t){return t}),define("sfr/router/router/URL",["require","sfr/utils/uri/component/Path","sfr/utils/uri/component/Query","sfr/utils/uri/component/Fragment","sfr/router/router/config"],function(t){function e(t,e){e=e||{},t=(t||"").trim()||o.path;var a=s.exec(t);a||console.warn("URI not valid:");var c=this.token=e.token||u,f=e.root||o.root;"/"===f.charAt(f.length-1)&&(f=f.substring(0,f.length-1)),this.root=f,t=t.split("#"),this.fragment=new i(t[1]),t=t[0].split(c);
var l=e.base||{};this.path=new r(t[0],l.path),this.query=new n(t[1]);var p=this.path.get();this.outRoot=0===p.indexOf(".."),this.outRoot&&(p=r.resolve(f+"/",p),0===p.indexOf(f)&&(p=p.substring(f.length),this.path.set(p),this.outRoot=!1)),this.outRoot||"/"===p.charAt(0)||this.path.set("/"+p),e.query&&this.query.add(e.query)}var r=t("sfr/utils/uri/component/Path"),n=t("sfr/utils/uri/component/Query"),i=t("sfr/utils/uri/component/Fragment"),o=t("sfr/router/router/config"),s=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),u="?";
return e.prototype.toString=function(){var t=this.root,e=this.path.get();return e=this.outRoot?r.resolve(t+"/",e):t+e,e+this.query.toString(this.token)+this.fragment.toString()},e.prototype.equalPath=function(t){return this.path.get()===t},e.prototype.equal=function(t){return this.query.equal(t.query)&&this.equalPath(t.path.get())},e.prototype.equalWithFragment=function(t){return this.equal(t)&&this.fragment.equal(t.fragment)},e.prototype.getQuery=function(){return this.query.get()},e.prototype.getPath=function(){return this.path.get()
},e}),define("sfr/router/router/config",[],{path:"/",root:"",mode:"async"}),define("sfr/router/router/controller",["require","sfr/lang/underscore","sfr/router/router/URL","sfr/router/router/config"],function(t){function e(t,e){r(t,e)||(u(t,e),a=t)}function r(t,e){return a&&t.equal(a)&&!e.force}function n(t){var e=l.root;if("/"===t.charAt(0)&&e)if(0===t.indexOf(e))t=t.replace(e,"");else{var r=e.split("/").slice(1);r=r.map(function(){return".."}),t=r.join("/")+t,a=null}return t}function i(t,e){return t||(t=n(location.pathname)),new f(t,{query:e,base:a})
}function o(t,r){if(t=t||{},!c.get(t,"state.disableServiceDispatch")){var o=n(location.pathname);if(location.search.length>1&&(o+=location.search),o=i(o),o.outRoot)return s(o.toString(),!0);var u=r?{src:"sync"}:c.extend({},t.state,{src:"history"});e(o,u)}}function s(t,e){p.dispose(),e?location.replace(t):location.href=t}var u,a,c=t("sfr/lang/underscore"),f=t("sfr/router/router/URL"),l=t("sfr/router/router/config"),p={};return p.init=function(t){window.addEventListener("popstate",o,!1),u=t,o(null,!0)
},p.redirect=function(t,n,o){return o=o||{},t=i(t,n),t.outRoot||"page"===l.mode?!r(t,o)&&s(t.toString()):(a.equalWithFragment(t)||history.pushState(o,o.title,t.toString()),void(o.silent||e(t,o)))},p.reset=function(t,n,o){return o=o||{},t=i(t,n),t.outRoot||"page"===l.mode?!r(t,o)&&s(t.toString()):(o.silent?a=t:e(t,o),void history.replaceState(o,o.title,t.toString()))},p.dispose=function(){window.removeEventListener("popstate",o,!1),a=null},p.ignoreRoot=n,p.createURL=i,p}),define("sfr/router/router",["require","sfr/lang/underscore","sfr/router/router/config","sfr/router/router/controller","sfr/utils/logger"],function(t){function e(){function t(t){var e=-1;
return t=t.toString(),f.some(function(r,n){return r.raw.toString()===t&&(e=n),-1!==e}),e}function e(t,e){for(var r,n={},i=e.params||[],o=t.match(e.path)||[],s=1;s<o.length;s++)r=i[s-1]||"$"+s,n[r]=decodeURIComponent(o[s]);return n}function s(t,n){n=n||{};var o,s=r({},t.getQuery()),a={},c=t.getPath();if(o=u(t),!o)throw new Error("can not find route for: "+c);o.path instanceof RegExp&&o.path.test(c)&&(a=e(c,o));var f={path:c,pathPattern:o.raw,query:s,params:a,url:i.ignoreRoot(t.toString()),originalUrl:t.toString(),options:n},p=[f,l];
l=f,o.fn.apply(o.thisArg,p)}function u(t){var e,r,n=t.getPath();return f.some(function(i){return i.path instanceof RegExp?i.path.test(n)&&(e=i):t.equalPath(i.path)&&(e=i),i.path||(r=i),!!e}),e||r}function a(t){var e={params:[]};return e.path=t.replace(/:([^\/]+)/g,function(t,r){return e.params.push(r),"([^/]+)"}),e.path=new RegExp("^"+e.path+"$"),e}var c={},f=[],l={};return c.pathPattern=function(t){t=i.ignoreRoot(t);var e=i.createURL(t),r=u(e);return r?r.raw:null},c.reset=function(t,e,r){i.reset(t,e,r)
},c.config=function(t){t=t||{};var e=t.root;e&&"/"===e.charAt(e.length-1)&&(e=t.root=e.substring(0,e.length-1)),e&&"/"!==e.charAt(0)&&(t.root="/"+e),r(n,t)},c.add=function(e,n,i){if(t(e)>=0)throw new Error("path already exist");var s={raw:e,path:e,fn:n,thisArg:i};o.isString(e)&&o.contains(e,":")&&(s=r(s,a(e))),f.push(s)},c.remove=function(e){var r=t(e);r>=0&&f.splice(r,1)},c.exist=function(e){return t(e)>=0},c.clear=function(){f=[]},c.redirect=function(t,e,r){i.redirect(t,e,r)},c.start=function(t){c.config(t),i.init(s)
},c.stop=function(){i.dispose(),c.clear(),l={}},c.controller=function(t){var e=i;i=t,o.forOwn(e,function(t,e){i.hasOwnProperty(e)||(i[e]=t)})},c.getState=function(){return l},c.ignoreRoot=i.ignoreRoot,c.createURL=i.createURL,c}var r=t("sfr/lang/underscore").extend,n=t("sfr/router/router/config"),i=t("sfr/router/router/controller"),o=t("sfr/lang/underscore");return t("sfr/utils/logger"),e}),define("sfr/utils/di",["require","sfr/lang/assert","sfr/lang/underscore"],function(t){function e(t){this.config=this.normalize(t),this.container=Object.create(null)
}var r=t("sfr/lang/assert"),n=t("sfr/lang/underscore");return e.prototype.resolve=function(t){var e=this.config[t];if(r(e,"module declaration not found: "+t),this.container[t]&&e.cache)return this.container[t];switch(void 0===e.value&&e.module&&(e.value=e.module),e.type){case"value":return this.container[t]=e.value;case"factory":r("function"==typeof e.value,"entity not injectable: "+e.value);var n=e.args||[];return this.container[t]=this.inject(e.value,n);default:throw new Error("DI type "+e.type+" not recognized")
}},e.prototype.inject=function(t,e){var r=e.map(function(t){return this.resolve(t)},this);return t.apply(null,r)},e.prototype.normalize=function(t){return n.forOwn(t,function(t){void 0===t.cache&&(t.cache=!0),void 0===t.type&&(t.type="value")}),t},e}),define("sfr/utils/logger",["require"],function(){function t(){c=a=Date.now()}function e(){var t=Array.prototype.slice.call(arguments);o&&t.unshift("["+r()+"]");var e,n=new Error("logger track").stack||"",i=n.split("\n")[3]||"",s="";e=/at\s+\(?(.*):\d+:\d+\)?$/.exec(i)||[];
var u=e[1];e=/([^\/?#]+)([?#]|$)/.exec(u)||[];var a=e[1];s+=a?a+":":"",e=/at ([\w\d.]+)\s*\(/.exec(i)||[];var c=e[1]||"anonymous";return s+=c,t.unshift("["+s+"]"),t}function r(){var t=Date.now(),e=(t-a)/1e3,r=e+"(+"+(t-c)+")";return c=t,r}function n(t,e){var r=new Function("impl","args","impl.apply(console, args);");if(r(t,e),u){var n=new Image,i=e.join(" ").replace(/\s+/g," ").trim();n.src=u+"/sfr/log/"+i}}function i(t,r){return function(){var t=e.apply(null,arguments);n(r,t)}}var o=!!location.search.match(/logger-timming/i),s=location.search.match(/logger-server=([^&]*)/i),u=s?decodeURIComponent(s[1]):!1,a=Date.now(),c=a;
return{log:i("log",console.log),debug:i("debug",console.log),info:i("info",console.info),warn:i("warn",console.warn),error:i("error",console.error),reset:t}}),define("sfr/utils/http",["require","sfr/lang/underscore","sfr/lang/promise","sfr/utils/url"],function(t){function e(t){return t instanceof FormData?"multipart/form-data":"application/x-www-form-urlencoded"}function r(t){var e;try{e=u.createXHR()}catch(r){return o.reject(r)}return e.open(t.method,t.url,!0),i.forOwn(t.headers,function(t,r){e.setRequestHeader(r,t)
}),i.assign(e,t.xhrFields),new o(function(r,i){e.onreadystatechange=function(){4===e.readyState&&(e=n(e),e.status>=200&&e.status<300?r(e):i(e))},e.send(t.data)})}function n(t){var e=t.getAllResponseHeaders().split("\r\n").filter(i.negate(i.isEmpty)).map(function(t){return i.split(t,/\s*:\s*/)});if(t.responseHeaders=i.fromPairs(e),t.data=t.responseText,"application/json"===t.responseHeaders["Content-Type"])try{t.data=JSON.parse(t.responseText)}catch(r){console.warn("Invalid JSON content with Content-Type: application/json")
}return t}var i=t("sfr/lang/underscore"),o=t("sfr/lang/promise"),s=t("sfr/utils/url"),u={};return u.ajax=function(t,n){return"object"==typeof t&&(n=t,t=""),n=i.defaultsDeep(n,{url:t,method:n&&n.type||"GET",headers:{},data:null,jsonp:!1,jsonpCallback:"sf_http_"+Math.random().toString(36).substr(2)}),i.forOwn(n.headers,function(t,e){n.headers[e]=t.toLowerCase(t)}),(n.headers["content-type"]||n.data)&&(n.headers["content-type"]=n.headers["content-type"]||e(n.data)),/application\/json/.test(n.headers["content-type"])?n.data=JSON.stringify(n.data):/form-urlencoded/.test(n.headers["content-type"])&&(n.data=s.param(n.data)),r(n)
},u.get=function(t,e){return u.ajax(t,{data:e})},u.post=function(t,e){return u.ajax(t,{method:"POST",data:e})},u.put=function(t,e){return u.ajax(t,{method:"PUT",data:e})},u.delete=function(t,e){return u.ajax(t,{method:"DELETE",data:e})},u.createXHR=function(){var t=!1;if(window.XMLHttpRequest?t=new XMLHttpRequest:window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLHTTP")),!t)throw new Error("Cannot create an XHR instance");return t},u}),define("sfr/utils/url",["require","sfr/utils/uri/URI","sfr/lang/underscore","sfr/utils/uri/component/Path","sfr/utils/uri/util/uri-parser"],function(t){function e(t){return new r(t)
}var r=t("sfr/utils/uri/URI"),n=t("sfr/lang/underscore"),i=t("sfr/utils/uri/component/Path"),o=t("sfr/utils/uri/util/uri-parser");return e.parse=function(t){return o(t)},e.resolve=function(t,e){return i.resolve(t,e)},e.param=function(t){return n.isObject(t)?n.map(t,function(t,e){return encodeURIComponent(e)+"="+encodeURIComponent(t)}).join("&"):t},e}),define("sfr/utils/cache",["require","sfr/lang/assert","sfr/utils/cache-namespace"],function(t){function e(t){if(!i.hasOwnProperty(t))throw new Error("cache namespace "+t+" undefined");
return i[t]}var r=t("sfr/lang/assert"),n=t("sfr/utils/cache-namespace"),i={},o={};return o.create=function(t,e){return r(t,"cannot create namespace with empty name"),r(!i[t],"namespace with "+t+" already created"),i[t]=new n(t,e)},o.destroy=function(t){r(i[t],"namespace with "+t+" not exist"),delete i[t]},o.using=function(t){return e(t)},o.set=function(t,r,n){return e(t).set(r,n)},o.get=function(t,r){return e(t).get(r)},o.size=function(t){return e(t).size()},o.rename=function(t,r,n){return e(t).rename(r,n)
},o.remove=function(t,r){return e(t).remove(r)},o.clear=function(t){return 0!==arguments.length?e(t).clear():void(i={})},o.contains=function(t,e){if(0===arguments.length)throw new Error("namespace not specified");return 1===arguments.length?i.hasOwnProperty(t):i.hasOwnProperty(t)?i[t].contains(e):!1},o.has=function(t){return i.hasOwnProperty(t)},o}),define("sfr/utils/cache-namespace",["require","sfr/lang/underscore"],function(t){function e(){}function r(t,r){this.name=t,this.list=[],this.options=n.assign({limit:3,onRemove:e},r)
}var n=t("sfr/lang/underscore");return r.prototype={constructor:r,setLimit:function(t){this.options.limit=t},get:function(t){var e=this.findIndexByKey(t);if(-1===e)return void 0;var r=this.list[e];return this.list.splice(e,1),this.list.push(r),r.value},set:function(t,e){for(this.remove(t);this.list.length>=this.options.limit;){var r=this.list.shift();this.options.onRemove(r.value,r.key,!0)}return this.list.push({key:t,value:e}),this},contains:function(t){return this.has(t)},has:function(t){return this.findIndexByKey(t)>-1
},rename:function(t,e){if(t===e)return this;this.remove(e);var r=this.findIndexByKey(t);if(-1===r)throw new Error("key not found:"+t);return this.list[r].key=e,this},remove:function(t){var e=this.findIndexByKey(t);if(e>-1){var r=this.list[e];this.options.onRemove(r.value,r.key,!1),this.list.splice(e,1)}return this},size:function(){return this.list.length},clear:function(){return this.list=[],this},findIndexByKey:function(t){return n.findIndex(this.list,function(e){return e.key===t})}},r}),define("sfr/utils/emitter",["require"],function(){function t(){}var e=t.prototype;
e._getEvents=function(){return this._events||(this._events={}),this._events},e._getMaxListeners=function(){return isNaN(this.maxListeners)&&(this.maxListeners=10),this.maxListeners},e.on=function(t,e){var r=this._getEvents(),n=this._getMaxListeners();r[t]=r[t]||[];var i=r[t].length;if(i>=n&&0!==n){var o="Warning: possible Emitter memory leak detected. "+i+" listeners added.";console.warn(o)}return r[t].push(e),this},e.once=function(t,e){function r(){n.off(t,r),e.apply(this,arguments)}var n=this;return r.listener=e,this.on(t,r),this
},e.off=function(t,e){var r=this._getEvents();if(0===arguments.length)return this._events={},this;var n=r[t];if(!n)return this;if(1===arguments.length)return delete r[t],this;for(var i,o=0;o<n.length;o++)if(i=n[o],i===e||i.listener===e){n.splice(o,1);break}return this},e.emit=function(t){for(var e=this._getEvents(),r=e[t],n=[],i=1;i<arguments.length;i++)n.push(arguments[i]);if(r)for(r=r.slice(0),i=0;i<r.length;i++)try{r[i].apply(this,n)}catch(o){console.error(o)}return this},e.listeners=function(t){var e=this._getEvents();
return e[t]||[]},e.setMaxListeners=function(t){return this.maxListeners=t,this};var r=Object.keys(e);return t.mixin=function(t){for(var n,i=0,o=r.length;o>i;i++)n=r[i],t[n]=e[n];return t},t}),define("sfr/utils/dom",["require"],function(){function t(t,r){e(t,r)||(t.className&&(t.className+=" "),t.className+=r)}function e(t,e){return r(e).test(t.className)}function r(t){return new RegExp("(^|\\s)"+t+"(\\s|$)")}return{addClass:t,hasClass:e}}),define("sfr/lang/underscore",["require","sfr/lang/assert"],function(t){function e(t,e){var r=t;
return(e||"").split(".").forEach(function(t){r=r?r[t]:void 0}),r}function r(t,e,r){t=t||{};var n=(e||"").split(".");n.forEach(function(e,i){t[e]=void 0!==t[e]?t[e]:{},i===n.length-1?t[e]=r:t=t[e]})}function n(t,e){for(var r=e.split("."),n=0;i(t,r[n])&&n<r.length;)t=t[r[n++]];return n>=r.length}function i(t,e){return null!==t&&void 0!==t&&z.call(t,e)}function o(t){return t=c(t),t.shift(),t}function s(t){var e=[];for(var r in t)e.push(r);return e}function u(t){return Object.keys(Object(t))}function a(t,e){t=t||{};
for(var r in t)if(t.hasOwnProperty(r)&&e(t[r],r,t)===!1)break;return t}function c(t){return t?M.slice.call(t):[]}function f(t){var e=o(arguments);return M.forEach.apply(t||[],e)}function l(t,e){if(q(t)){var r=o(arguments);return M.map.apply(t||[],r)}var n=[];return a(t,function(){n.push(e.apply(null,arguments))}),n}function p(t,e,r){if(q(t)){var n=o(arguments);return M.reduce.apply(t,n)}var i,s,a=u(t);for(arguments.length>=3?(i=r,s=0):a.length>0&&(i=t[a[0]],s=1);s<a.length;s++){var c=a[s];i=e(i,t[c],c,t)
}return i}function h(t){var e=o(arguments);return M.slice.apply(t||[],e)}function d(t){var e=o(arguments);return M.splice.apply(t||[],e)}function g(t){var e=o(arguments);return D.split.apply(t||"",e)}function v(t,e,r){for(var n=r||0;n<t.length;n++)if(e(t[n],n,t))return n;return-1}function m(t){return o(arguments).reduce(function(t,e){return t.replace("%s",e)},t)}function y(){return O.apply(null,h(arguments,0).reverse())}function w(t){var e=typeof t;return null!=t&&("object"===e||"function"===e)}function b(t){return"number"==typeof t&&t>-1&&t%1===0&&$>=t
}function q(t){return null!=t&&b(t.length)&&!_(t)}function _(t){var e=typeof t;return"function"===e}function R(t){return t instanceof String||"string"==typeof t}function A(t,e,r){return void 0===r&&(r=0),t.indexOf(e,r)>-1}function j(t){return t instanceof RegExp}function O(t){t=null==t?{}:t;var e=h(arguments,1);return f(e,function(e){S(t,e)}),t}function E(t,e){return t?void a(e,function(e,r){return w(e)&&w(t[r])?E(t[r],e):void(t[r]=e)}):t}function S(t,e){return t?(a(e,function(e,r){t[r]=e}),t):t}function x(){var t={},e=h(arguments,0).reverse();
return f(e,function(e){E(t,e)}),t}function k(t){var e={};return l(t,function(t){var r=t[0],n=t[1];e[r]=n}),e}function P(t){return t instanceof Array}function C(t){return P(t)?0===t.length:!t}function L(t){return function(){return!t.apply(null,arguments)}}function U(t){return t.bind.apply(t,h(arguments))}function I(t){var e=h(arguments);return e.shift(),function(){var r=h(arguments),n=[r,arguments.length,0].concat(e);return d.apply(null,n),t.apply(null,r)}}function N(t,e){return H("function"==typeof e,"wrapper should be a function"),function(){var r=Array.prototype.slice.call(arguments,0);
return r.unshift(t),e.apply(this,r)}}function F(t,e){var r=function(){};r.prototype=e.prototype;var n=t.prototype,i=t.prototype=new r;for(var o in n)n.hasOwnProperty(o)&&(i[o]=n[o]);return t.prototype.constructor=t,t}var H=t("sfr/lang/assert"),M=Array.prototype,T=Object.prototype,z=T.hasOwnProperty,D=String.prototype,X={},$=Number.MAX_SAFE_INTEGER||9007199254740991;return X.keysIn=s,X.keys=u,X.get=e,X.set=r,X.has=n,X.forOwn=a,X.assign=O,X.merge=O,X.extend=O,X.defaults=y,X.defaultsDeep=x,X.fromPairs=k,X.slice=h,X.splice=d,X.forEach=f,X.map=l,X.reduce=p,X.toArray=c,X.findIndex=v,X.split=g,X.format=m,X.isArray=P,X.isFunction=_,X.isEmpty=C,X.isString=R,X.isObject=w,X.isArrayLike=q,X.isLength=b,X.isRegExp=j,X.inherits=F,X.contains=A,X.noop=function(){},X.partial=U,X.partialRight=I,X.negate=L,X.wrap=N,X
}),define("sfr/lang/promise",["require","sfr/lang/assert","sfr/lang/set-immediate"],function(t){function e(t){if(!(this instanceof e))throw"Promise must be called with new operator";if("function"!=typeof t)throw"callback not defined";this._state=i,this._result,this._fulfilledCbs=[],this._rejectedCbs=[],this._errorPending=!1,this._fromResolver(t)}function r(t){c(t._state===s,u);var e;e="function"==typeof window.PromiseRejectionEvent?window.PromiseRejectionEvent:CustomEvent;var r=new e("unhandledrejection",{promise:t,reason:t._result});
return r.reason=r.reason||t._result,r}function n(t){return t&&"function"==typeof t.then}var i=0,o=1,s=2,u="cannot make RejectionEvent when promise not rejected",a={longStackTraces:!1},c=t("sfr/lang/assert"),f=t("sfr/lang/set-immediate");return e.prototype._fulfill=function(t){this._result=t,this._state=o,this._flush()},e.prototype._reject=function(t){a.longStackTraces&&t&&(t.stack+="\n"+this._originalStack),this._result=t,this._state=s,this._errorPending=!0,this._flush(),f(function(){this._checkUnHandledRejection()
}.bind(this))},e.prototype._resolve=function(t){n(t)?this._fromResolver(t.then.bind(t)):this._fulfill(t)},e.prototype._fromResolver=function(t){var e=!1,r=this;try{t(function(t){e||(e=!0,r._resolve(t))},function(t){e||(e=!0,r._reject(t))})}catch(n){if(e)return;e=!0,r._reject(n)}},e.prototype._checkUnHandledRejection=function(){if(this._errorPending){var t=r(this);window.dispatchEvent(t)}},e.prototype._flush=function(){if(this._state!==i){var t=this._state===s?this._rejectedCbs:this._fulfilledCbs;
t.forEach(function(t){if(this._state===s&&this._errorPending&&(this._errorPending=!1),"function"==typeof t){var e=this._result;f(function(){t(e)})}},this),this._rejectedCbs=[],this._fulfilledCbs=[]}},e.prototype._done=function(t,e){this._fulfilledCbs.push(t),this._rejectedCbs.push(e),this._flush()},e.prototype.then=function(t,r){var n=this;return new e(function(e,i){var o;n._done(function(r){if("function"!=typeof t)return e(r);try{o=t(r)}catch(n){return i(n)}e(o)},function(t){if("function"!=typeof r)return i(t);
try{o=r(t)}catch(n){return i(n)}e(o)})})},e.prototype.catch=function(t){return this.then(function(t){return t},t)},e.prototype.finally=function(t){return this.then(t,t)},e.resolve=function(t){return n(t)?t:new e(function(e){return e(t)})},e.reject=function(t){return new e(function(e,r){r(t)})},e.all=function(t){return new e(function(r,n){function i(){0>=s&&r(o)}var o=t.map(function(){return void 0}),s=t.length;t.map(e.resolve).forEach(function(t,e){t.then(function(t){o[e]=t,s--,i()},n)}),i()})},e.fromCallback=function(t){return new e(function(e){t(function(t){e(t)
})})},e.mapSeries=function(t,r){var n=e.resolve("init"),i=[];return t.forEach(function(e,o){n=n.then(function(){return r(e,o,t)}).then(function(t){return i.push(t)})}),n.then(function(){return i})},e}),define("sfr/lang/assert",["require"],function(){function t(t,e){if(!t)throw new Error(e)}return t}),define("sfr/lang/map",["require","sfr/lang/underscore"],function(t){function e(){this.size=0,this._data={}}function r(t){return n.isRegExp(t)?"reg_"+t:n.isString(t)?"str_"+t:"other_"+t}var n=t("sfr/lang/underscore");
return e.prototype.set=function(t,e){var n=r(t);this._data.hasOwnProperty(n)||this.size++,this._data[n]={key:t,value:e}},e.prototype.keys=function(){var t=this._data;return Object.keys(this._data).map(function(e){var r=t[e];return r.key})},e.prototype.forEach=function(t){var e=this._data;Object.keys(this._data).forEach(function(r){var n=e[r];t(n.value,n.key)})},e.prototype.has=function(t){var e=r(t);return this._data.hasOwnProperty(e)},e.prototype.delete=function(t){var e=r(t);this._data.hasOwnProperty(e)&&(delete this._data[e],this.size--)
},e.prototype.get=function(t){var e=r(t),n=this._data[e];return n?n.value:void 0},e.prototype.clear=function(){this.size=0,this._data={}},e}),define("sfr/lang/set-immediate",["require"],function(){function t(t){if(r.setImmediate)r.setImmediate(t);else if(r.MessageChannel){var e=new MessageChannel;e.port1.onmessage=t,e.port2.postMessage(n)}else r.addEventListener&&r.postMessage?(r.addEventListener("message",t,!1),r.postMessage(n,"*")):r.setTimeout(t)}function e(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:Function("return this")()
}var r=e(),n="setImmediate polyfill";return t}),define("sfr/utils/uri/URI",["require","sfr/utils/uri/util/uri-parser","sfr/utils/uri/component/Scheme","sfr/utils/uri/component/UserName","sfr/utils/uri/component/Password","sfr/utils/uri/component/Host","sfr/utils/uri/component/Port","sfr/utils/uri/component/Path","sfr/utils/uri/component/Query","sfr/utils/uri/component/Fragment"],function(t){function e(t){t=n(t);var e,r=this;Object.keys(i).forEach(function(n){e=i[n],r[n]=new e(t[n])})}function r(t){var e=[],r=t.username.toString(),n=t.password.toString(),i=t.host.toString(),o=t.port.toString();
return(r||n)&&e.push(r+":"+n+"@"),e.push(i),e.push(o),e.join("")}var n=t("sfr/utils/uri/util/uri-parser"),i={scheme:t("sfr/utils/uri/component/Scheme"),username:t("sfr/utils/uri/component/UserName"),password:t("sfr/utils/uri/component/Password"),host:t("sfr/utils/uri/component/Host"),port:t("sfr/utils/uri/component/Port"),path:t("sfr/utils/uri/component/Path"),query:t("sfr/utils/uri/component/Query"),fragment:t("sfr/utils/uri/component/Fragment")};return e.prototype.set=function(){var t=0,e={};arguments.length>1&&(e.name=arguments[t++]),e.data=Array.prototype.slice.call(arguments,t);
var r=this[e.name];if(r)r.set.apply(r,e.data);else{var o=this,s=n(e.data[0]);Object.keys(i).forEach(function(t){o[t].set(s[t])})}},e.prototype.get=function(){var t={name:arguments[0],data:Array.prototype.slice.call(arguments,1)},e=this[t.name];return e?e.get.apply(e,t.data):void 0},e.prototype.toString=function(t){var e,n=this[t];if(n)e=n.toString();else{e=[];var i=this.scheme.toString();i&&e.push(i+":");var o=r(this);i&&o&&e.push("//"),e.push(o),e.push(this.path.toString()),e.push(this.query.toString()),e.push(this.fragment.toString()),e=e.join("")
}return e},e.prototype.equal=function(t){t instanceof e||(t=new e(t));for(var r,n=!0,o=Object.keys(i),s=0;n&&(r=o[s]);s++)n="port"===r?this[r].equal(t[r].get(),this.scheme.get()):this[r].equal(t[r]);return n},e}),define("sfr/utils/uri/component/Abstract",["require"],function(){function t(){var t=Array.prototype.slice.call(arguments);this.set.apply(this,t)}return t.prototype.get=function(){return this.data},t.prototype.set=function(t){this.data=t||""},t.prototype.add=function(t){this.set(t)},t.prototype.remove=function(){this.data=""
},t.prototype.toString=function(){return this.data.toString()},t.prototype.equal=function(e){return e instanceof t&&(e=e.get()),this.data==e},t}),define("sfr/utils/uri/component/Fragment",["require","sfr/lang/underscore","sfr/utils/uri/component/Abstract"],function(t){function e(t){n.call(this,t)}var r=t("sfr/lang/underscore").inherits,n=t("sfr/utils/uri/component/Abstract"),i="#";return r(e,n),e.prototype.toString=function(t){return t=t||i,this.data?t+this.data:""},e}),define("sfr/utils/uri/component/Host",["require","sfr/lang/underscore","sfr/utils/uri/component/Abstract"],function(t){function e(t){n.call(this,t)
}var r=t("sfr/lang/underscore").inherits,n=t("sfr/utils/uri/component/Abstract");return r(e,n),e.prototype.set=function(t){t=t||"",this.data=t.toLowerCase()},e.prototype.equal=function(t){return t=t instanceof e?t.get():t||"",this.data===t.toLowerCase()},e}),define("sfr/utils/uri/component/Password",["require","sfr/lang/underscore","sfr/utils/uri/component/Abstract"],function(t){function e(t){n.call(this,t)}var r=t("sfr/lang/underscore").inherits,n=t("sfr/utils/uri/component/Abstract");return r(e,n),e
}),define("sfr/utils/uri/component/Path",["require","sfr/lang/underscore","sfr/utils/uri/component/Abstract"],function(t){function e(t){return t||(t="/"),t}function r(t){return t=t.split("/"),t.pop(),t.join("/")}function n(t,e){for(var r,n=0,i=t.length-1;r=t[i];i--)"."===r?t.splice(i,1):".."===r?(t.splice(i,1),n++):n&&(t.splice(i,1),n--);if(e)for(;n-->0;)t.unshift("..");return t}function i(t,e){s.call(this,t,e)}var o=t("sfr/lang/underscore").inherits,s=t("sfr/utils/uri/component/Abstract");return i.resolve=function(t,e){if(e=e||"","/"===e.charAt(0))return i.resolve(e);
var o="/"===t.charAt(0),s=!1;e?(t=r(t),s="/"===e.charAt(e.length-1)):t.length>1&&(s="/"===t.charAt(t.length-1));var u=t.split("/").concat(e.split("/")).filter(function(t){return!!t});return u=n(u,!o),(o?"/":"")+(u.length>0?u.join("/")+(s?"/":""):"")},o(i,s),i.prototype.set=function(t,e){e instanceof i&&(e=e.get());var r=[t||""];e&&r.unshift(e),this.data=i.resolve.apply(i,r)},i.prototype.equal=function(t){var r=e(this.data);return t=e(t instanceof i?t.get():i.resolve(t||"")),r===t},i.prototype.resolve=function(t,e){t instanceof i&&(t=t.get());
var r=[this.data];e?r.unshift(t):r.push(t),this.data=i.resolve.apply(i,r)},i}),define("sfr/utils/uri/component/Port",["require","sfr/lang/underscore","sfr/utils/uri/component/Abstract"],function(t){function e(t){n.call(this,t)}var r=t("sfr/lang/underscore").inherits,n=t("sfr/utils/uri/component/Abstract"),i={ftp:"21",ssh:"22",telnet:"23",http:"80",https:"443",ws:"80",wss:"443"};return r(e,n),e.prototype.equal=function(t,r){var n=this.data||i[r];return t instanceof e&&(t=t.get()),t=t||i[r],n===t},e.prototype.toString=function(){return this.data?":"+this.data:""
},e}),define("sfr/utils/uri/component/Query",["require","sfr/lang/underscore","sfr/utils/uri/component/Abstract","sfr/utils/uri/util/parse-query","sfr/utils/uri/util/stringify-query"],function(t){function e(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;t=t.slice(0),t=t.slice(0),t.sort(),e.sort();for(var r=!0,n=0,i=t.length;r&&i>n;n++)r=t[n]==e[n];return r}function r(t,r){if(!u.isObject(t)||!u.isObject(r))return!1;var n=Object.keys(t),i=Object.keys(r);if(n.length!==i.length)return!1;
for(var o,s,a=!0,c=0;a&&(o=n[c]);c++){if(!r.hasOwnProperty(o)){a=!1;break}s=t[o],a=Array.isArray(s)?e(s,r[o]):s==r[o]}return a}function n(t){return t=Array.isArray(t)?t.map(function(t){return i(t)}):null===t||void 0===t?null:i(t)}function i(t){return t=String(t).replace(/\+/g,"%20"),decodeURIComponent(t)}function o(t,e,r){var i=r[t];return e=n(e),i?(Array.isArray(i)||(i=[i]),Array.isArray(e)?i=i.concat(e):i.push(e)):i=e,r[t]=i,r}function s(t){t=t||{},a.call(this,t)}var u=t("sfr/lang/underscore"),a=t("sfr/utils/uri/component/Abstract"),c=t("sfr/utils/uri/util/parse-query"),f=t("sfr/utils/uri/util/stringify-query"),l="?";
return u.inherits(s,a),s.prototype.set=function(){if(1===arguments.length){var t=arguments[0];if(u.isObject(t)){var e=this.data={};u.forOwn(t,function(t,r){e[r]=n(t)})}else this.data=c(t)}else this.data[arguments[0]]=n(arguments[1])},s.prototype.get=function(t){return t?this.data[t]:u.extend({},this.data)},s.prototype.toString=function(t){t=t||l;var e=f(this.data);return e?t+e:""},s.prototype.equal=function(t){return u.isString(t)?t=c(t):t instanceof s&&(t=t.get()),r(this.data,t)},s.prototype.add=function(t,e){var r=this.data;
u.isObject(t)?Object.keys(t).forEach(function(e){o(e,t[e],r)}):o(t,e,r),this.data=r},s.prototype.remove=function(t){t?this.data.hasOwnProperty(t)&&delete this.data[t]:this.data={}},s}),define("sfr/utils/uri/component/Scheme",["require","sfr/lang/underscore","sfr/utils/uri/component/Abstract"],function(t){function e(t){n.call(this,t)}var r=t("sfr/lang/underscore"),n=t("sfr/utils/uri/component/Abstract");return r.inherits(e,n),e.prototype.set=function(t){t=t||"",this.data=t.toLowerCase()},e.prototype.equal=function(t){return t=t instanceof e?t.get():t||"",this.data===t.toLowerCase()
},e}),define("sfr/utils/uri/component/UserName",["require","sfr/lang/underscore","sfr/utils/uri/component/Abstract"],function(t){function e(t){n.call(this,t)}var r=t("sfr/lang/underscore"),n=t("sfr/utils/uri/component/Abstract");return r.inherits(e,n),e}),define("sfr/utils/uri/util/parse-query",["require"],function(){function t(t){var r={};t=t.split("&");var n,i;return t.forEach(function(t){t&&(t=t.split("="),n=t[0],i=t.length>=2?e(t[1]):null,r[n]?(Array.isArray(r[n])||(r[n]=[r[n]]),r[n].push(i)):r[n]=i)
}),r}function e(t){return t=String(t).replace(/\+/g,"%20"),decodeURIComponent(t)}return t}),define("sfr/utils/uri/util/stringify-query",["require"],function(){function t(t){var e,r=[];return Object.keys(t).forEach(function(n){e=t[n],Array.isArray(e)||(e=[e]),e.forEach(function(t){r.push(null===t?n:n+"="+encodeURIComponent(t||""))})}),r.join("&")}return t}),define("sfr/utils/uri/util/uri-parser",["require","sfr/lang/underscore"],function(t){function e(t){var e={},r=["scheme","username","password","host","port","path","query","fragment"];
return r.forEach(function(r){e[r]=t[r]||s}),e}function r(t){var e={};return t.replace(/^([^@]+@)?([^:]+)(:\d+)?$/,function(t,r,n,i){r&&(r=r.slice(0,-1),r=r.split(":"),e.username=r[0],e.password=r[1]),e.host=n,i&&(e.port=i.substring(1))}),e}function n(t,e){var n=/[^:]+:\d{2,}(\/|$)/.test(t);return n&&(t=t.split("/"),u.extend(e,r(t.shift())),t.length>0&&(e.path="/"+t.join("/"))),n}function i(t,e){var r=t.indexOf(":"),n=t.indexOf("/");n=n>=0?n:t.length;var i=r>=0&&n>r;return i&&(e.scheme=t.substring(0,r),e.path=t.substring(r+1)),i
}function o(t){var e={},o=t.indexOf("#");return o>=0&&(e.fragment=t.substring(o+1),t=t.substring(0,o)),o=t.indexOf("?"),o>=0&&(e.query=t.substring(o+1),t=t.substring(0,o)),o=t.indexOf("://"),o>=0?(e.scheme=t.substring(0,o),t=t.substring(o+3),"file"===e.scheme?e.path=t:(t=t.split("/"),u.extend(e,r(t.shift())),t.length>0&&(e.path="/"+t.join("/"))),e):n(t,e)?e:i(t,e)?e:(t=t.split("/"),e.host=t.shift(),t.length>0&&(e.path="/"+t.join("/")),e)}var s,u=t("sfr/lang/underscore");return function(t){return u.isString(t)&&(t=o(t)),e(t)
}}),define("sfr/action",["require","sfr/utils/cache","sfr/lang/promise","sfr/lang/assert","sfr/utils/logger","sfr/lang/underscore","sfr/utils/dom","sfr/utils/url"],function(t){function e(t,e,a,c,f,l){function p(){function t(t,e){return function(r){return arguments[0]=(r||"").replace(/#.*$/,""),t.apply(e,arguments)}}var e=r.create("pages",{onRemove:function(t,e,r){o.isFunction(t.onRemove)&&t.onRemove(e,r)},limit:32});return e.get=t(e.get,e),e.set=t(e.set,e),e.contains=t(e.contains,e),e}function h(){function t(t){return u=t,s=(s+1)%i,a
}function e(t,e){var i=s;return o.isFunction(r)&&r(),r=t,n.mapSeries(u,function(t){return"function"==typeof t&&i===s?t():void 0}).catch(e).then(function(){r=null})}var r,i=1e4,s=0,u=[],a={reset:t,exec:e,aborted:!1};return a}function d(t){var e=u.parse(t);return"sfr"===e.scheme&&"index"===e.host?q:t}function g(r,n){var i=t.ignoreRoot(e.pathname+e.search),o=t.createURL(i).toString(),s=t.createURL(r,n).toString();return w.contains(o)?void w.rename(o,s):void console.warn("current page not found, cannot transfer to",r)
}function v(t){t=t||window.event;var e=y(t.target||t.srcElement,function(t){return"A"===t.tagName});if(e){var r=e.getAttribute("data-sf-href"),n=e.getAttribute("data-sf-options");if(r){t.preventDefault();try{n=JSON.parse(n)||{}}catch(i){console.warn("JSON parse failed, fallback to empty options"),n={}}n.src="hijack";var o={event:t,anchor:e},u=m(e)+r;A.redirect(u,null,n,o),s.addClass(e,j.visitedClassName)}}}function m(t){var e=y(t,function(t){return/(^|\s)rt-view($|\s)/.test(t.className)});return e?e.getAttribute("data-base")||"":""
}function y(t,e){for(var r=t;null!==r&&!e(r);)r=r.parentNode;return r}var w,b,q,_,R,A=new f,j={},O={},E=h();return A.init=function(){l.init(this.dispatch),A.pages=w=p(),b=!1,j={root:"/",visitedClassName:"visited"},q="/",_=!0,R=0},A.getState=function(){return O},A.regist=function(t,e){i(t,"invalid path pattern"),i(e,"invalid service"),e.singleton=!0,l.register(t,null,e)},A.unregist=function(t){l.unRegister(t)},A.dispatch=function(t,r){i(t,"cannot dispatch with options:"+t),A.emit("dispatching",{current:t,previous:r,extra:O});
var n=o.get(t,"options.src"),s=l.getOrCreate(r.url,r.pathPattern);r.service=s;var u=l.getOrCreate(t.url,t.pathPattern,"history"!==n&&"back"!==n);t.service=u,w.contains(t.url)||w.set(t.url,{id:R,isIndex:_}),t.page=w.get(t.url),r.page=w.get(r.url);var a=O;return O={},b&&(b=!1,t.options.src="back"),t.options&&"sync"===t.options.src?q=t.url||"/":_=!1,c.ensureAttached(),E.reset([function(){return s?s.singleton?s.detach(t,r,a):s.beforeDetach(t,r,a):void 0},function(){return u?u.singleton?u.create(t,r,a):u.beforeAttach(t,r,a):void 0
},function(){return s?s.singleton?s.destroy(t,r,a):s.detach(t,r,a):void 0},function(){return u?u.attach(t,r,a):void 0}]).exec(function(){u&&u.abort&&u.abort(t,r,a)},function(r){console.error(r),"sync"!==o.get(t,"options.src")&&e.replace(e.href)})},A.isIndexPage=function(){return _},A.exist=function(t){return l.isRegistered(t)},A.config=function(e){return 0!==arguments.length&&(o.assign(j,e),t.config(j)),j},A.redirect=function(r,n,i,s){A.emit("redirecting",r),r=d(r),o.assign(O,s),i=o.assign({},i,{id:R++});
try{i.silent&&g(r,n),t.redirect(r,n,i)}catch(a){throw a.url=u.resolve(j.root,r),e.replace(a.url),A.emit("redirectFailed",a),a}},A.back=function(){b=!0,a.back()},A.reset=function(e,r,n,i){_&&(q=e),g(e,r),o.assign(O,i),t.reset(e,r,n)},A.start=function(e){arguments.length&&A.config(e),document.body.addEventListener("click",v),t.start()},A.stop=function(){document.body.removeEventListener("click",v),t.stop(),t.clear()},A.destroy=function(){A.stop(),r.destroy("pages"),l.destroy(),A.pages=w=void 0,l.unRegisterAll()
},A.update=function(r,n,i,o){i=i?i:{},i.hasOwnProperty("silent")||(i.silent=!0);var s=t.ignoreRoot(e.pathname+e.search),u=t.createURL(s).toString(),a=t.ignoreRoot(r),c=(a||"").replace(/\?.*/,""),f=t.getState(),l={from:{url:u},to:{url:a,path:c},extra:o};return A.partialUpdate(r,{replace:!0,state:f,transition:l,to:o&&o.container&&o.container.get(0),query:n,options:i})},A.partialUpdate=function(r,i){var s=t.ignoreRoot(e.pathname+e.search),u=t.createURL(s).toString(),a=w.get(u);g(r,i.query),i=o.assign({},{fromUrl:r,replace:!1,routerOptions:{},page:a},i);
var c=l.getOrCreate(r),f=c.partialUpdate(r,i);return i.routerOptions.silent=!0,t.reset(r||e.href,i.query,i.routerOptions),n.resolve(f)},A.init(),A}var r=t("sfr/utils/cache"),n=t("sfr/lang/promise"),i=t("sfr/lang/assert"),o=(t("sfr/utils/logger"),t("sfr/lang/underscore")),s=t("sfr/utils/dom"),u=t("sfr/utils/url");return e}),define("sfr/service",["require"],function(){var t=function(){};return t.prototype.create=function(){},t.prototype.attach=function(){},t.prototype.detach=function(){},t.prototype.destroy=function(){},t.prototype.update=function(){},t
}),define("sfr/services",["require","sfr/lang/map","sfr/lang/underscore","sfr/lang/assert","sfr/utils/logger","sfr/utils/cache"],function(t){var e=t("sfr/lang/map"),r=t("sfr/lang/underscore"),n=t("sfr/lang/assert"),i=(t("sfr/utils/logger"),t("sfr/utils/cache"));return function(t){function o(t){return w.serviceInstances.setLimit(t)}function s(t){y=new e,m=t,v=w.urlEntries=new e,g=w.serviceInstances=i.create("services",{onRemove:function(t,e,n){return!t.singleton&&r.isFunction(t.destroy)?t.destroy(e,n):void 0
},limit:8})}function u(){i.destroy("services")}function a(e,r,i){n(e,"invalid path pattern"),n(!v.has(e),"path already registerd"),t.add(e,m),v.set(e,{service:i,config:r})}function c(t){return v.has(t)}function f(){v.keys().forEach(l),v.clear()}function l(e){n(e,"invalid path pattern"),n(c(e),"path not registered"),t.remove(e),v.delete(e)}function p(t){var e=y.get(t);return void 0===e?void 0:g.get(e)}function h(t,e){var r=b++;return y.set(t,r),e.id=r,g.set(r,e),e}function d(e,r){var n=p(e);if(n)return n;
arguments.length<2&&(r=t.pathPattern(e));var i=v.get(r);if(i){var o=i.service,s=i.config,u=o.singleton?o:new o(e,s);return h(e,u)}}var g,v,m,y,w={init:s,destroy:u,register:a,unRegister:l,isRegistered:c,unRegisterAll:f,getOrCreate:d,setInstanceLimit:o,urlEntries:null},b=0;return w}}),define("sfr/resource",["require","sfr/utils/http","sfr/lang/underscore"],function(t){function e(t){this.url=t}var r=t("sfr/utils/http"),n=t("sfr/lang/underscore");return e.prototype={getUrl:function(t){var e=this.url;
return n.forOwn(t,function(t,r){e=e.replace(":"+r,t)}),e=e.replace(/:[a-zA-Z]\w*/g,"")},create:function(t,e){var n=this.getUrl(e);return r.post(n,t)},query:function(t){var e=this.getUrl(t);return r.get(e)},update:function(t,e){var n=this.getUrl(e);return r.put(n,t)},"delete":function(t){var e=this.getUrl(t);return r.delete(e)}},e.prototype.constructor=e,e}),define("sfr/view",["require"],function(){var t=function(){this._init()};return t.prototype={constructor:t,_init:function(){},set:function(){},get:function(){},create:function(){},render:function(){},update:function(){},attach:function(){},detach:function(){},destroy:function(){},on:function(){},off:function(){}},t
}),define("sfr/doc",["require"],function(){function t(t){function e(){var e=t.querySelector("#sfr-app");e||t.body.appendChild(r)}var r=t.querySelector("#sfr-app");return r||(r=t.createElement("div"),r.setAttribute("id","sfr-app")),r.ensureAttached=e,r.ensureAttached(),r}return t}),define("sfr/config",["require","sfr/action","sfr/router/router","sfr/view","sfr/service","sfr/services","sfr/resource","sfr/doc","sfr/utils/cache","sfr/utils/http","sfr/utils/url","sfr/utils/di","sfr/utils/emitter","sfr/lang/assert","sfr/lang/underscore","sfr/lang/promise","sfr/lang/map","sfr/utils/logger"],function(t){var e={action:{type:"factory",module:t("sfr/action"),args:["router","location","history","doc","emitter","services"]},router:{type:"factory",module:t("sfr/router/router")},view:{type:"value",module:t("sfr/view")},service:{type:"value",module:t("sfr/service")},services:{type:"factory",args:["router"],module:t("sfr/services")},resource:{type:"value",module:t("sfr/resource")},doc:{type:"factory",module:t("sfr/doc"),args:["document"]},cache:{type:"value",module:t("sfr/utils/cache")},http:{type:"value",module:t("sfr/utils/http")},url:{type:"value",module:t("sfr/utils/url")},di:{type:"value",module:t("sfr/utils/di")},emitter:{type:"value",module:t("sfr/utils/emitter")},assert:{type:"value",module:t("sfr/lang/assert")},_:{type:"value",module:t("sfr/lang/underscore")},promise:{type:"value",module:t("sfr/lang/promise")},map:{type:"value",module:t("sfr/lang/map")},window:{type:"value",value:window},document:{type:"value",value:window.document},location:{type:"value",value:window.location},history:{type:"value",value:window.history},logger:{type:"value",module:t("sfr/utils/logger")}};
return e}),define("sfr",["sfr/utils/di","sfr/config"],function(t,e){var r=new t(e);return Object.keys(e).forEach(r.resolve,r),r.container})}();